<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Language Loop - Learn foreign languages through audio repetition">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>Language Loop</title>

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div id="app">
        <!-- Welcome Screen -->
        <div id="welcome-view" class="view hidden">
            <div class="welcome-container">
                <div class="welcome-icon">ğŸµ</div>
                <h1 id="welcome-title">Welcome to Language Loop</h1>
                <p class="welcome-subtitle" id="welcome-subtitle">Learn languages through audio repetition</p>

                <div class="welcome-steps">
                    <div class="step">
                        <div class="step-icon">ğŸ“</div>
                        <h3 id="step1-title">Create Playlists</h3>
                        <p id="step1-desc">Organize your sentences into playlists, just like music</p>
                    </div>
                    <div class="step">
                        <div class="step-icon">ğŸ”Š</div>
                        <h3 id="step2-title">Auto Voice Generation</h3>
                        <p id="step2-desc">Sentences are spoken automatically in your target language</p>
                    </div>
                    <div class="step">
                        <div class="step-icon">ğŸ”</div>
                        <h3 id="step3-title">Repeat & Learn</h3>
                        <p id="step3-desc">Configure repetitions and practice continuously</p>
                    </div>
                </div>

                <div class="welcome-config">
                    <h3>Language Settings</h3>
                    <div class="form-group">
                        <label for="global-target-lang">Target Language (Learning)</label>
                        <select id="global-target-lang">
                            <option value="en-US">English</option>
                            <option value="zh-CN">Chinese</option>
                            <option value="ja-JP">Japanese</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="global-native-lang">Native Language</label>
                        <select id="global-native-lang">
                            <option value="en-US">English</option>
                            <option value="zh-CN">Chinese</option>
                            <option value="ja-JP">Japanese</option>
                        </select>
                    </div>
                </div>

                <button id="get-started-btn" class="btn btn-primary btn-large">Get Started</button>
            </div>
        </div>

        <!-- Playlist Library View -->
        <div id="library-view" class="view hidden">
            <header class="app-header">
                <button id="language-settings-btn" class="btn btn-icon" title="Language Settings">ğŸŒ</button>
                <h1>ğŸ“š My Playlists</h1>
                <button id="add-playlist-btn" class="btn btn-icon" title="Create Playlist">+</button>
            </header>

            <div id="playlists-container" class="playlists-grid">
                <!-- Playlists will be rendered here -->
            </div>

            <div id="empty-library" class="empty-state hidden">
                <div class="empty-icon">ğŸµ</div>
                <h2>No playlists yet</h2>
                <p>Create your first playlist to start learning</p>
                <button class="btn btn-primary" onclick="document.getElementById('add-playlist-btn').click()">Create
                    Playlist</button>
            </div>
        </div>

        <!-- Player View -->
        <div id="player-view" class="view hidden">
            <header class="app-header">
                <button id="back-to-library-btn" class="btn btn-icon">â†</button>
                <h1 id="current-playlist-name">Playlist</h1>
                <button id="playlist-menu-btn" class="btn btn-icon">â‹®</button>
            </header>

            <div class="player-container">
                <div class="current-sentence-display">
                    <div id="current-target-text" class="target-text">Select a sentence to play</div>
                    <div id="current-native-text" class="native-text"></div>
                </div>

                <div class="playback-controls">
                    <button id="prev-btn" class="btn btn-control" title="Previous">â®</button>
                    <button id="play-pause-btn" class="btn btn-control btn-play" title="Play">â–¶</button>
                    <button id="next-btn" class="btn btn-control" title="Next">â­</button>
                </div>

                <div class="progress-info">
                    <span id="current-position">0</span> / <span id="total-sentences">0</span>
                </div>

                <div class="sleep-timer-controls hidden">
                    <label for="sleep-timer-player">Sleep Timer:</label>
                    <select id="sleep-timer-player" class="sleep-timer-select">
                        <option value="0">Off</option>
                        <option value="15">15 min</option>
                        <option value="30">30 min</option>
                        <option value="45">45 min</option>
                        <option value="60">60 min</option>
                        <option value="90">90 min</option>
                        <option value="120">120 min</option>
                    </select>
                    <span id="sleep-timer-countdown" class="timer-countdown hidden"></span>
                </div>
            </div>

            <div class="sentences-list">
                <div class="list-header">
                    <h3>Sentences</h3>
                    <button id="add-sentence-btn" class="btn btn-small">+ Add</button>
                </div>
                <div id="sentences-container">
                    <!-- Sentences will be rendered here -->
                </div>

                <div id="empty-playlist" class="empty-state hidden">
                    <div class="empty-icon">ğŸ“</div>
                    <h3>No sentences yet</h3>
                    <p>Add your first sentence to start practicing</p>
                </div>
            </div>
        </div>

        <!-- Test View -->
        <div id="test-view" class="view hidden">
            <header class="app-header">
                <button id="back-from-test-btn" class="btn btn-icon" title="Back">â†</button>
                <h1 id="test-mode-title">Writing Test</h1>
                <button id="test-menu-btn" class="btn btn-icon" title="Menu">â‹®</button>
            </header>

            <div class="test-container">
                <div class="test-progress">
                    <span id="test-current">1</span> / <span id="test-total">0</span>
                    <span id="test-score" style="margin-left: 1rem;">Score: <span id="test-correct">0</span>/<span
                            id="test-attempted">0</span></span>
                </div>

                <div class="test-prompt">
                    <div class="test-prompt-label">Translate to target language:</div>
                    <div id="test-prompt-text" class="test-prompt-text"></div>
                </div>

                <div id="test-input-area" class="test-input-area">
                    <!-- Writing Test -->
                    <div id="writing-test-input" class="hidden">
                        <textarea id="test-answer-input" rows="3" placeholder="Type your answer here..."></textarea>
                        <button id="submit-answer-btn" class="btn btn-primary">Submit Answer</button>
                    </div>

                    <!-- Speaking Test -->
                    <div id="speaking-test-input" class="hidden">
                        <button id="speak-answer-btn" class="btn btn-primary btn-large">ğŸ¤ Speak Answer</button>
                        <div id="speaking-status" class="recording-status"></div>
                        <div id="recognized-text" class="recognized-text hidden"></div>
                    </div>
                </div>

                <div id="test-feedback" class="test-feedback hidden">
                    <div id="feedback-message" class="feedback-message"></div>
                    <div id="feedback-comparison" class="feedback-comparison"></div>
                    <button id="next-test-btn" class="btn btn-primary">Next Sentence</button>
                </div>

                <div id="test-complete" class="test-complete hidden">
                    <div class="test-complete-icon">ğŸ‰</div>
                    <h2>Test Complete!</h2>
                    <div class="test-final-score">
                        Final Score: <span id="final-score">0</span>/<span id="final-total">0</span>
                        (<span id="final-percentage">0</span>%)
                    </div>
                    <div class="test-actions">
                        <button id="retry-test-btn" class="btn btn-primary">Retry Test</button>
                        <button id="back-to-player-btn" class="btn btn-secondary">Back to Playlist</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sentence Editor Modal -->
        <div id="editor-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="editor-title">Add Sentence</h2>
                    <button id="close-editor-btn" class="btn btn-icon">Ã—</button>
                </div>

                <form id="sentence-form">
                    <div class="form-group">
                        <label for="target-text-input">Target Language Sentence</label>
                        <textarea id="target-text-input" rows="3" required
                            placeholder="Enter sentence in the language you're learning"></textarea>
                        <button type="button" id="voice-input-btn" class="btn btn-secondary"
                            style="margin-top: 0.5rem;">
                            ğŸ¤ Voice Input
                        </button>
                        <span id="voice-input-status" class="recording-status"></span>
                    </div>

                    <div class="form-group">
                        <label for="native-text-input">Native Language Translation</label>
                        <textarea id="native-text-input" rows="3" required
                            placeholder="Enter translation in your native language"></textarea>
                        <button type="button" id="auto-translate-btn" class="btn btn-secondary"
                            style="margin-top: 0.5rem;">
                            ğŸŒ Auto-Translate
                        </button>
                    </div>


                    <div class="form-group">
                        <label>Custom Voice (Optional)</label>
                        <div class="recording-controls">
                            <button type="button" id="record-btn" class="btn btn-secondary">ğŸ™ï¸ Record</button>
                            <button type="button" id="play-recording-btn" class="btn btn-secondary hidden">â–¶ Play
                                Recording</button>
                            <button type="button" id="delete-recording-btn" class="btn btn-secondary hidden">ğŸ—‘ï¸
                                Delete</button>
                            <span id="recording-status" class="recording-status"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="add-another-checkbox">
                            Add another sentence after saving
                        </label>
                        <small>Keep this form open to quickly add multiple sentences</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="cancel-editor-btn" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Create Playlist Modal -->
        <div id="create-playlist-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Create Playlist</h2>
                    <button id="close-playlist-modal-btn" class="btn btn-icon">Ã—</button>
                </div>

                <form id="playlist-create-form">
                    <div class="form-group">
                        <label for="playlist-name-input">Playlist Name</label>
                        <input type="text" id="playlist-name-input" required placeholder="e.g., Daily Chinese Practice">
                    </div>

                    <div class="form-group">
                        <label for="playlist-target-lang">Target Language (Learning)</label>
                        <select id="playlist-target-lang" required>
                            <option value="en-US">English</option>
                            <option value="zh-CN">Chinese</option>
                            <option value="ja-JP">Japanese</option>
                        </select>
                        <small>The language you want to learn</small>
                    </div>

                    <div class="form-group">
                        <label for="playlist-native-lang">Native Language (Translation)</label>
                        <select id="playlist-native-lang" required>
                            <option value="en-US">English</option>
                            <option value="zh-CN">Chinese</option>
                            <option value="ja-JP">Japanese</option>
                        </select>
                        <small>Your native language for translations</small>
                    </div>

                    <div class="form-group">
                        <label for="playlist-icon">Icon (Emoji)</label>
                        <input type="text" id="playlist-icon" maxlength="2" placeholder="ğŸ“š" value="ğŸ“š">
                        <small>Choose an emoji to represent this playlist</small>
                    </div>

                    <div class="form-group">
                        <label for="playlist-description">Description (Optional)</label>
                        <textarea id="playlist-description" rows="2"
                            placeholder="What is this playlist for?"></textarea>
                        <small>Brief description of this playlist</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="cancel-playlist-btn" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Playlist</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button id="close-settings-btn" class="btn btn-icon">Ã—</button>
                </div>

                <form id="settings-form">
                    <div class="form-group">
                        <label for="repeat-count-input">Repeat Count per Sentence</label>
                        <input type="number" id="repeat-count-input" min="1" max="10" value="2">
                        <small>How many times to repeat each sentence</small>
                    </div>

                    <div class="form-group">
                        <label for="pause-duration-input">Pause Duration (seconds)</label>
                        <input type="number" id="pause-duration-input" min="0" max="10" step="0.5" value="1">
                        <small>Pause between repetitions</small>
                    </div>
                    <div class="form-group">
                        <label>
                            Speak native language after target language
                        </label>
                        <input type="checkbox" id="speak-native-checkbox">
                        <small>When enabled, plays translation after the target language sentence</small>
                    </div>

                    <div class="form-group">
                        <label for="speech-rate-input">Speech Rate: <span id="speech-rate-value">1.0</span>x</label>
                        <input type="range" id="speech-rate-input" min="0.5" max="2.0" step="0.1" value="1.0">
                        <small>Adjust the speed of text-to-speech (0.5x = slower, 2.0x = faster)</small>
                    </div>

                    <div class="form-group">
                        <label for="voice-select">Voice</label>
                        <select id="voice-select">
                            <option value="">Auto (System Default)</option>
                        </select>
                        <small>Choose a specific voice for text-to-speech</small>
                    </div>



                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Playlist Modal -->
        <div id="edit-playlist-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Edit Playlist</h2>
                    <button id="close-edit-playlist-btn" class="btn btn-icon">Ã—</button>
                </div>

                <form id="edit-playlist-form">
                    <div class="form-group">
                        <label for="edit-playlist-name">Playlist Name</label>
                        <input type="text" id="edit-playlist-name" required placeholder="Enter playlist name">
                    </div>

                    <div class="form-group">
                        <label>Choose Icon</label>
                        <div class="icon-picker">
                            <button type="button" class="icon-option" data-icon="ğŸ“š">ğŸ“š</button>
                            <button type="button" class="icon-option" data-icon="ğŸ‡¯ğŸ‡µ">ğŸ‡¯ğŸ‡µ</button>
                            <button type="button" class="icon-option" data-icon="ğŸ‡¨ğŸ‡³">ğŸ‡¨ğŸ‡³</button>
                            <button type="button" class="icon-option" data-icon="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸</button>
                            <button type="button" class="icon-option" data-icon="ğŸ‡ªğŸ‡¸">ğŸ‡ªğŸ‡¸</button>
                            <button type="button" class="icon-option" data-icon="ğŸ‡«ğŸ‡·">ğŸ‡«ğŸ‡·</button>
                            <button type="button" class="icon-option" data-icon="ğŸ‡©ğŸ‡ª">ğŸ‡©ğŸ‡ª</button>
                            <button type="button" class="icon-option" data-icon="ğŸ¯">ğŸ¯</button>
                            <button type="button" class="icon-option" data-icon="âœ¨">âœ¨</button>
                            <button type="button" class="icon-option" data-icon="ğŸŒŸ">ğŸŒŸ</button>
                            <button type="button" class="icon-option" data-icon="ğŸ’¡">ğŸ’¡</button>
                            <button type="button" class="icon-option" data-icon="ğŸ“">ğŸ“</button>
                            <button type="button" class="icon-option" data-icon="ğŸ“–">ğŸ“–</button>
                            <button type="button" class="icon-option" data-icon="âœï¸">âœï¸</button>
                            <button type="button" class="icon-option" data-icon="ğŸ¨">ğŸ¨</button>
                            <button type="button" class="icon-option" data-icon="ğŸµ">ğŸµ</button>
                        </div>
                        <input type="text" id="edit-playlist-icon" maxlength="2" placeholder="Or type emoji"
                            style="margin-top: 0.5rem;">
                    </div>

                    <div class="form-group">
                        <label for="edit-playlist-description">Description</label>
                        <textarea id="edit-playlist-description" rows="3"
                            placeholder="What is this playlist for?"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="cancel-edit-playlist-btn" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Playlist Menu Modal -->
        <div id="playlist-menu-modal" class="modal hidden">
            <div class="modal-content modal-menu">
                <button id="writing-test-btn" class="menu-item">âœï¸ Writing Test</button>
                <button id="speaking-test-btn" class="menu-item">ğŸ¤ Speaking Test</button>
                <button id="edit-playlist-btn" class="menu-item">âœï¸ Edit Playlist</button>
                <button id="settings-btn" class="menu-item">âš™ï¸ Settings</button>
                <button id="export-playlist-btn" class="menu-item">ğŸ“¤ Export Playlist</button>
                <button id="import-playlist-btn" class="menu-item">ğŸ“¥ Import Playlist</button>
                <button id="delete-playlist-btn" class="menu-item danger">ğŸ—‘ï¸ Delete Playlist</button>
                <button id="close-menu-btn" class="menu-item">âœ–ï¸ Close</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="import-file-input" accept=".json" style="display: none;">

    <!-- Audio element for playback -->
    <audio id="audio-player"></audio>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <script src="js/storage.js"></script>
    <script src="js/translation.js"></script>
    <script src="js/welcome.js"></script>
    <script src="js/test.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/playlist.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>

</html>